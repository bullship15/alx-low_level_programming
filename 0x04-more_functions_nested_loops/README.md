This is all about more nested functions nested loops
